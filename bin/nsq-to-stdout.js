#!/usr/bin/env node

// Generated by CoffeeScript 1.7.1
(function() {
  'use strict';
  var debug, nsq, program, reader, util;

  util = require('util');

  debug = require('debug')('nsq:main');

  program = require('commander');

  nsq = require('nsq.js');

  program.version(require("" + __dirname + "/../package.json").version || '0.0.1').option('-h, --host     [host:port]', 'nsqlookupd', ':4161').option('-t, --topic    [topic]', 'nsq topic to monitor').option('-c, --channel  [channel]', 'nsq channel', 'debug').option('-p, --prettyfy', 'prettyfy JSON message').parse(process.argv);

  if (program.topic == null) {
    program.help();
  }

  reader = nsq.reader({
    nsqlookupd: [program.host],
    topic: program.topic,
    channel: program.channel
  });

  reader.on('error', function(error) {
    return debug('nsq error: %s', error);
  });

  console.log(program);

  reader.on('message', function(msg) {
    msg.finish();
    if (program.prettyfy) {
      return util.log(msg.body.json());
    } else {
      return console.log(msg.body.toString());
    }
  });

}).call(this);
